<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="../../assets/style-guide.css">
	<title>header</title>
</head>
<body>
  <!-- 컴포넌트 구현 영역 -->
  <div class="guide-component-preview">
    <!-- 공통 overlay -->
    <div class="overlay"></div>

    <header class="header">
      <div class="header__logo">
        <a href="/" class="header__logo-link">
          <img src="../../assets/images/logo.svg" alt="intelliDOCS">
        </a>
      </div>
      <div class="header__utility">
        <!-- 사용자 관련 정보 버튼 -->
        <!-- 비로그인 상태의 로그인 버튼 (이미지) -->
        <button class="header__user header__user--login" type="button" style="display: none;">
          <span class="visually-hidden">로그인</span>
        </button>

        <!-- 로그인 상태의 사용자 버튼 -->
        <button class="header__user header__user--logged-in avatar-btn" type="button" aria-controls="globalSideNav" aria-expanded="false">
          <!-- 텍스트 아바타 -->
          <span class="avatar avatar--text avatar--mobile-large" style="display: none;">
            <span class="avatar__text">엘</span>
          </span>
          <!-- 이미지 아바타 -->
          <span class="avatar avatar--mobile-large">
            <img class="avatar__image" src="../../assets/images/avatar/sample_01.png" alt="사용자 아바타">
          </span>
          <span class="avatar-btn__text hide-on-mobile">엘루오</span>
        </button>

        <!-- 메뉴 버튼 -->
        <button class="header__menu" type="button" aria-label="사이드 메뉴 열기" aria-controls="globalSideNav" aria-expanded="false">
          <span class="header__menu-icon" aria-hidden="true"></span>
        </button>
      </div>
    </header>

    <!-- 사이드 네비게이션 -->
    <nav class="header__nav" id="globalSideNav" aria-hidden="true" inert>
      <button class="header__nav-close" type="button" aria-label="사이드 메뉴 닫기">
        <span class="icon-close" aria-hidden="true"></span>
      </button>
      <!-- 로그인 상태 사용자 정보 -->
      <div class="header__nav-user header__nav-user--logged-in">
        <div class="avatar avatar--md">
          <img class="avatar__image" src="../../assets/images/avatar/sample_01.png" alt="사용자 아바타">
        </div>
        <div class="avatar__info-wrapper">
          <div class="avatar__name">엘루오</div>
          <div class="avatar__sub">eluo@example.com</div>
        </div>
      </div>
      <!-- 비로그인 상태 사용자 정보 -->
      <div class="header__nav-user header__nav-user--logged-out" style="display: none;">
          <p>로그인이 필요합니다.<br>서비스 이용을 위해 로그인해 주세요.</p>
          <a href="/" class="header__nav-user-login-btn">로그인하기</a>
      </div>
      <ul class="header__nav-list">
        <li><a href="#">AI 템플릿 서비스</a></li>
        <li><a href="#">AI 지식정보 서비스</a></li>
        <li><a href="#">AI 지식정보 서비스 관리</a></li>
      </ul>
      <div class="header__nav-footer">
        <!-- 비로그인 상태 -->
        <a href="#" class="header__nav-login" style="display: none;">
          <i class="icon-bg icon-user-sm" aria-hidden="true"></i>로그인
        </a>
        <a href="#" class="header__nav-join" style="display: none;">
          <i class="icon-bg icon-user-add" aria-hidden="true"></i>회원가입
        </a>
        <!-- 로그인 상태 -->
        <a href="#" class="header__nav-password">
          <i class="icon-bg icon-lock" aria-hidden="true"></i>비밀번호 변경
        </a>
        <a href="#" class="header__nav-logout">
          <i class="icon-bg icon-logout" aria-hidden="true"></i>로그아웃
        </a>
      </div>
    </nav>
  </div>

  <!-- 컴포넌트 설명 영역 -->
  <div class="container guide-section pt-10">
    <h1 class="t-title-1 guide-title">Header 컴포넌트</h1>
    
    <section class="guide-section">
      <h2 class="t-title-2 guide-title">컴포넌트 구조</h2>
      
      <div class="guide-article">
        <h3 class="t-title-3 guide-subtitle">기본 구조</h3>
        <p>헤더 컴포넌트는 다음 두 가지 주요 부분으로 구성됩니다:</p>
        <ul class="guide-list">
          <li>
            <span><strong>메인 헤더(.header)</strong>: 로고와 사용자 유틸리티 영역을 포함</span>
          </li>
          <li>
            <span><strong>사이드 네비게이션(.header__nav)</strong>: 메뉴와 사용자 정보를 포함하는 슬라이드 메뉴</span>
          </li>
        </ul>
        
        <div class="guide-code-block">
          <pre><code>&lt;!-- 메인 헤더 --&gt;
  &lt;header class="header"&gt;
    &lt;div class="header__logo"&gt;...&lt;/div&gt;
    &lt;div class="header__utility"&gt;...&lt;/div&gt;
  &lt;/header&gt;

  &lt;!-- 사이드 네비게이션 --&gt;
  &lt;nav class="header__nav" id="globalSideNav" aria-hidden="true" inert&gt;
    ...
  &lt;/nav&gt;</code></pre>
        </div>
      </div>
      
      <div class="guide-article">
        <h3 class="t-title-3 guide-subtitle">사용자 상태에 따른 변형</h3>
        <p>헤더는 다음 두 가지 상태를 지원합니다:</p>
        <ul class="guide-list">
          <li>
            <span><strong>로그인 상태</strong>: 아바타와 사용자 이름 표시 (.header__user--logged-in)</span>
          </li>
          <li>
            <span><strong>비로그인 상태</strong>: 로그인 버튼 표시 (.header__user--login)</span>
          </li>
        </ul>
        
        <div class="guide-code-block">
          <pre><code>&lt;!-- 비로그인 상태 --&gt;
  &lt;button class="header__user header__user--login" type="button"&gt;
    &lt;span class="visually-hidden"&gt;로그인&lt;/span&gt;
  &lt;/button&gt;

  &lt;!-- 로그인 상태 --&gt;
  &lt;button class="header__user header__user--logged-in avatar-btn" type="button"&gt;
    &lt;span class="avatar"&gt;...&lt;/span&gt;
    &lt;span class="avatar-btn__text"&gt;사용자명&lt;/span&gt;
  &lt;/button&gt;</code></pre>
        </div>
      </div>
    </section>
    
    <section class="guide-section">
      <h2 class="t-title-2 guide-title">사이드 네비게이션</h2>
      
      <div class="guide-article">
        <h3 class="t-title-3 guide-subtitle">구성 요소</h3>
        <p>사이드 네비게이션은 다음 요소로 구성됩니다:</p>
        <ul class="guide-list">
          <li>
            <span><strong>닫기 버튼(.header__nav-close)</strong>: 상단 우측에 위치</span>
          </li>
          <li>
            <span><strong>사용자 정보(.header__nav-user)</strong>: 로그인 상태에 따라 다른 정보 표시</span>
          </li>
          <li>
            <span><strong>메뉴 리스트(.header__nav-list)</strong>: 주요 메뉴 항목 목록</span>
          </li>
          <li><strong>메뉴 푸터(.header__nav-footer)</strong>: 비밀번호 변경 및 로그아웃 링크</li>
        </ul>
        
        <div class="guide-code-block">
          <pre><code>&lt;nav class="header__nav" id="globalSideNav" aria-hidden="true" inert&gt;
    &lt;button class="header__nav-close"&gt;...&lt;/button&gt;
    
    &lt;!-- 사용자 정보 영역 --&gt;
    &lt;div class="header__nav-user header__nav-user--logged-in"&gt;...&lt;/div&gt;
    
    &lt;!-- 메뉴 리스트 --&gt;
    &lt;ul class="header__nav-list"&gt;...&lt;/ul&gt;
    
    &lt;!-- 메뉴 푸터 --&gt;
    &lt;div class="header__nav-footer"&gt;...&lt;/div&gt;
  &lt;/nav&gt;</code></pre>
        </div>
      </div>
    </section>
    
    <section class="guide-section">
      <h2 class="t-title-2 guide-title">접근성 기능</h2>
      
      <div class="guide-article">
        <h3 class="t-title-3 guide-subtitle">주요 접근성 기능</h3>
        <p>헤더 컴포넌트는 다음과 같은 접근성 기능을 제공합니다:</p>
        <ul class="guide-list">
          <li>
            <span><strong>ARIA 속성</strong>: aria-controls, aria-expanded, aria-hidden 속성을 사용하여 상태 관리</span>
          </li>
          <li>
            <span><strong>포커스 트랩</strong>: 사이드 메뉴 오픈 시 포커스가 메뉴 내에서만 순환하도록 설정</span>
          </li>
          <li>
            <span><strong>inert 속성</strong>: 메뉴가 닫혀 있을 때 스크린 리더가 메뉴 내용에 접근할 수 없도록 설정</span>
          </li>
        </ul>
        
        <div class="guide-notice">
          <strong>중요:</strong> inert 속성은 모든 브라우저에서 완전히 지원되지 않을 수 있습니다. 필요한 경우 polyfill을 사용하세요.
        </div>
      </div>
    </section>
    
    <section class="guide-section">
      <h2 class="t-title-2 guide-title">JavaScript 기능</h2>
      
      <div class="guide-article">
        <h3 class="t-title-3 guide-subtitle">메뉴 제어 기능</h3>
        <p>사이드 메뉴의 열기/닫기 기능은 다음 함수로 제어됩니다:</p>
        <ul class="guide-list">
          <li>
            <span><strong>openNav()</strong>: 메뉴 열기, 오버레이 표시, 포커스 트랩 설정</span>
          </li>
          <li>
            <span><strong>closeNav()</strong>: 메뉴 닫기, 오버레이 숨김, 포커스 트랩 해제</span>
          </li>
          <li>
            <span><strong>toggleNav()</strong>: 현재 상태에 따라 메뉴 열기/닫기 전환</span>
          </li>
        </ul>
        
        <div class="guide-code-block">
          <pre><code>// 메뉴 열기
  function openNav() {
    nav.classList.add('is-open');
    App.overlay.open();
    nav.setAttribute('aria-hidden', 'false');
    nav.removeAttribute('inert');
    // 포커스 트랩 설정
    releaseFocusTrap = App.trapFocus(nav);
  }

  // 메뉴 닫기
  function closeNav() {
    nav.classList.remove('is-open');
    App.overlay.close();
    nav.setAttribute('aria-hidden', 'true');
    nav.setAttribute('inert', '');
    // 포커스 트랩 해제
    if (releaseFocusTrap) releaseFocusTrap();
  }</code></pre>
        </div>
      </div>
      
      <div class="guide-article">
        <h3 class="t-title-3 guide-subtitle">필요한 스크립트</h3>
        <p>헤더 기능을 사용하기 위해 다음 스크립트가 필요합니다:</p>
        <ul class="guide-list">
          <li>
            <span><strong>overlay.js</strong>: 오버레이 제어 기능</span>
          </li>
          <li>
            <span><strong>a11y.js</strong>: 접근성 유틸리티 (포커스 트랩, 키보드 탐색 등)</span>
          </li>
        </ul>
        
        <div class="guide-code-block">
          <pre><code>&lt;script src="../../assets/scripts/common/overlay.js"&gt;&lt;/script&gt;
&lt;script src="../../assets/scripts/common/a11y.js"&gt;&lt;/script&gt;</code></pre>
        </div>
      </div>
    </section>
    
    <section class="guide-section">
      <h2 class="t-title-2 guide-title">반응형 디자인</h2>
      
      <div class="guide-article">
        <p>헤더 컴포넌트는 다음과 같은 반응형 기능을 제공합니다:</p>
        <ul class="guide-list">
          <li>
            <span><strong>모바일 버전</strong>: 아바타 텍스트 숨김 (.hide-on-mobile), 아바타 크기 조정 (.avatar--mobile-large)</span>
          </li>
          <li>
            <span><strong>데스크톱 버전</strong>: 아바타와 사용자 이름 함께 표시</span>
          </li>
        </ul>
      </div>
    </section>
  </div>

  <!-- 공통 스크립트 -->
  <script src="../../assets/scripts/common/overlay.js"></script>
  <script src="../../assets/scripts/common/a11y.js"></script>

  <!-- header 전용 스크립트 -->
  <script>
    const nav = document.querySelector('.header__nav');
    const userButton = document.querySelector('.header__user--logged-in');
    const menuButton = document.querySelector('.header__menu');
    const closeButton = document.querySelector('.header__nav-close');
  
    let releaseFocusTrap = null; // 포커스 트랩 해제 함수
    let releaseEsc = null; // ESC 해제 함수
    let lastOpener = null; // 마지막으로 연 트리거
  
    function openNav(opener) { // 오프너를 인자로 받음
      lastOpener = opener || menuButton;
  
      nav.classList.add('is-open');
      App.overlay.open();
      nav.setAttribute('aria-hidden', 'false');
      nav.removeAttribute('inert');
  
      if (userButton) userButton.setAttribute('aria-expanded', 'true');
      menuButton.setAttribute('aria-expanded', 'true');
  
      // trapFocus 설정
      releaseFocusTrap = App.a11y.trapFocus(nav);
  
      // ESC로 닫기 + 포커스 복귀(마지막 오프너)
      releaseEsc = App.a11y.escapeHandler(nav, closeNav, lastOpener);
    }
  
    function closeNav() {
      // 먼저 포커스 복귀(보강: escapeHandler가 실패해도 복귀 보장)
      (lastOpener || menuButton).focus();
  
      nav.classList.remove('is-open');
      App.overlay.close();
      nav.setAttribute('aria-hidden', 'true');
      nav.setAttribute('inert', '');
      if (userButton) userButton.setAttribute('aria-expanded', 'false');
      menuButton.setAttribute('aria-expanded', 'false');
  
      // 바인딩 해제
      if (releaseFocusTrap) { releaseFocusTrap(); releaseFocusTrap = null; }
      if (releaseEsc) { releaseEsc(); releaseEsc = null; }
    }
  
    function toggleNav(opener) {
      nav.classList.contains('is-open') ? closeNav() : openNav(opener);
    }
  
    // 트리거 연결 (오프너 전달)
    if (userButton) userButton.addEventListener('click', () => toggleNav(userButton));
    menuButton.addEventListener('click', () => toggleNav(menuButton));
  
    // 닫기 버튼/오버레이
    closeButton.addEventListener('click', closeNav);
    App.overlay.onClick(closeNav);
  </script>
</body>
</html>